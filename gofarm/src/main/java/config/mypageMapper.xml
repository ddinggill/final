<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper    
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">
 	
 	<select id="mileage_list" resultType="com.mycompany.gofarm.mypage.dto.MileageDTO"
 	 parameterType="int">
 	<![CDATA[
 		select * from mileage where usercode= #{usercode} order by m_day desc
	]]>
 	</select>
 	
 	<select id="payment_list" resultType="com.mycompany.gofarm.mypage.dto.MileageDTO"
 	 parameterType="int">
 	<![CDATA[
 		select * from mileage where usercode= #{usercode} and m_content = '마일리지 출금' order by m_day desc
	]]>
 	</select>
 	
 	<select id="mileage_view" resultType="com.mycompany.gofarm.mypage.dto.MileageDTO"
 	 parameterType="int">
 		SELECT * FROM mileage WHERE usercode= #{usercode} and m_day = (SELECT MAX(m_day)AS m_day FROM mileage)
 	</select>
 	
 	<insert id="mileage_insert" parameterType="com.mycompany.gofarm.mypage.dto.MileageDTO">
 		insert into mileage values(#{usercode},#{m_list},#{m_total}, sysdate, #{m_content})
 	</insert>
 	
 	<update id="mileage_update" parameterType="com.mycompany.gofarm.mypage.dto.MileageDTO">
 		update USER_DETAIL set mileage=#{m_total} where usercode=#{usercode}
 	</update>
 	
 	<select id="userDetail_view" resultType="com.mycompany.gofarm.user.dto.UserDTO"
 	 parameterType="int">
 	 	SELECT * FROM USER_DETAIL WHERE usercode= #{usercode}
 	</select>
 	
	<select id="job_view" resultType="com.mycompany.gofarm.job.dto.JobDTO"
 	 parameterType="int">
 	<![CDATA[
 		select * from job where usercode=#{usercode} order by j_Registration desc
	]]>
 	</select>
 	
 	<select id="jobSearch_view" resultType="com.mycompany.gofarm.job.dto.JobSearchDTO"
 	 parameterType="int">
 	<![CDATA[
 		select * from jobsearch where usercode=#{usercode} order by js_registration desc
	]]>
 	</select>
 	
 	<select id="jobcheck_list" resultType="com.mycompany.gofarm.job.dto.JobDTO"
 	 parameterType="int">
 	<![CDATA[
 		select a.name j_info, j.job job
 		from (select USERCODE, name from users u, jobcheck ch where ch.JK_USERCODE = u.USERCODE and ch.JOBSEARCHCODE=#{JOBSEARCHCODE}) a, job j 
 		where a.USERCODE = j.USERCODE
	]]>
 	</select>
 	
 	<select id="mySell_list" resultType="com.mycompany.gofarm.mypage.dto.MySellDTO"
 	 parameterType="int">
 	<![CDATA[
 		select b.pd_name pd_name, b.de_date de_date, b.de_cnt de_cnt, b.name name, b.phone phone, ud.USER_HOME USER_HOME 
 		from (select a.pd_name , a.de_date , a.de_cnt , name, phone, usercode 
 			from(select pd_name, de_date, de_cnt, de_usercode 
 				from product p, deal d 
 				where p.prod_code = d.prod_code and usercode=#{usercode})a, users u 
 			where a.de_usercode= u.USERCODE)b, user_detail ud 
 		where b.usercode = ud.usercode
	]]>
 	</select>
</mapper>
